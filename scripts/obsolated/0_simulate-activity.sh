#!/bin/bash
source /home/kali/Pentesting/scripts/config/config.sh

# Function to generate random sleep time between requests
random_sleep() {
    min_sleep=3  # Minimum sleep time in seconds
    max_sleep=8 # Maximum sleep time in seconds
    sleep_duration=$((RANDOM % (max_sleep - min_sleep + 1) + min_sleep))
    sleep $sleep_duration
}



# List of URL addresses to visit
URLS="https://www.seznam.cz https://www.youtube.com https://www.novinky.cz https://www.idnes.cz https://www.stream.cz https://www.bbc.com https://www.reddit.com https://www.cnn.com https://www.super.cz https://www.twitch.tv https://www.wikipedia.org https://www.yahoo.com"

DEPTH=10


# Loop indefinitely to simulate continuous browsing
while true; do
	### Login to DVWA (its legit app)
	# get user token
	TOKEN=$(curl -c /home/kali/Pentesting/utils/dvwa.session -s http://$target_ip_msf/dvwa/login.php | grep 'user_token' | awk -F 'value=' '{print $2}' | cut -d"'" -f2)
	# get session id
	PHPSESSID=$(grep PHPSESSID /home/kali/Pentesting/utils/dvwa.session | awk -F' ' '{print $7}')
	# log in
	curl -L -b "PHPSESSID=${PHPSESSID};security=low" -v -d "username=admin&password=password&Login=Login&user_token=${TOKEN}" http://$target_ip_msf/dvwa/login.php
	# ping router
	curl -s -b "PHPSESSID=${PHPSESSID};security=low" -d "ip=$router_ip&submit=submit" http://$target_ip_msf/dvwa/vulnerabilities/exec/index.php
	# query user from sql db
	curl -s -b "PHPSESSID=${PHPSESSID};security=low" "http://$target_ip_msf/dvwa/vulnerabilities/sqli/index.php?id=1&Submit=Submit"
	# write message to guestbook
	curl -s -b "PHPSESSID=${PHPSESSID};security=low" http://$target_ip_msf/dvwa/vulnerabilities/xss_s/ --data 'txtName=Pepa&mtxMessage=Hello everyone!</script>&btnSign=Sign+Guestbook'
	
	
	### Visit URL
	# Select a random URL from the list
	links=($URLS)
    
	for i in $(seq 0 $DEPTH); do
		random_index=$((RANDOM % ${#links[@]}))
		
		url=${links[$random_index]}
    
		# Simulate browsing by sending a GET request to the URL
		echo "Visiting: $url, Depth: $i"
		html_content=$(curl -sS $url --compressed)

		# Extract links from the HTML content
		links=(`echo "$html_content" | grep -o 'href="https://[^" ;]*"' | cut -d '"' -f 2`)
		
		
		if [[ ${#links[@]} -eq 0 ]]
		then
		        echo "No more links."
		        break
		fi
		
		# Generate random sleep time before the next request
		random_sleep
	done
done
