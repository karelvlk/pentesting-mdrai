#!/bin/bash

CONFIG_FILE="$1"

echo "CONFIG_FILE: $CONFIG_FILE"

# Check if the configuration file exists
if [ ! -f "$CONFIG_FILE" ]; then
    echo "Error: Configuration file $CONFIG_FILE does not exist."
    exit 1
fi

# Backup the current crontab
crontab -l > config/crontab_backup.txt
if [ $? -ne 0 ]; then
    echo "Warning: Failed to backup the current crontab."
fi

# Read the configuration file and update the crontab
while IFS= read -r line; do
    # Skip empty lines and lines that start with '#'
    if [ -z "$line" ] || [[ "$line" == \#* ]]; then
        continue
    fi
    
    # Append the job to the crontab
    (crontab -l 2>/dev/null; echo "$line") | crontab -
    if [ $? -ne 0 ]; then
        echo "Failed to add cron job: $line"
    else
        echo "Added cron job: $line"
    fi
done < "$CONFIG_FILE"

echo "Cron jobs have been updated successfully."
